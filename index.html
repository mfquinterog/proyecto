<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <title>Predicción de Números</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
      body {
        background-color: #f4f4f9;
        font-family: 'Roboto', sans-serif;
      }

      h1, h2 {
        font-weight: bold;
      }

      canvas {
        background-color: #ffffff;
        border: 2px solid #ccc;
        margin-top: 10px;
        border-radius: 10px;
      }

      #resultado {
        font-size: 3rem;
        color: #28a745;
        font-weight: bold;
      }

      button {
        margin: 10px 5px;
        padding: 10px 20px;
        border-radius: 8px;
      }

      footer {
        background-color: #343a40;
        color: #ffffff;
        padding: 20px;
      }

      .spinner-border {
        margin: 20px auto;
      }

      .list-group-item {
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="text-center py-4">
      <img class="d-block mx-auto mb-3" src="ubosque.png" alt="Logo Universidad" width="150">
      <h1 class="display-5">Predicción de Números Escritos a Mano</h1>
      <p class="lead">Dibuja un número y observa cómo el modelo lo predice en tiempo real</p>
    </header>

    <!-- Canvas Section -->
    <main class="container text-center">
      <div class="canvas-container">
        <h2>Dibuja un Número</h2>
        <canvas id="bigcanvas" width="200" height="200"></canvas>
        <canvas id="smallcanvas" width="28" height="28" style="display: none;"></canvas>
        <div class="mt-3">
          <button class="btn btn-primary" id="limpiar" onclick="limpiar()">Limpiar</button>
          <button class="btn btn-success" id="predecir" onclick="predecir()" disabled>Predecir</button>
        </div>
        <div id="resultado" class="mt-4"></div>
        <div id="loading" style="display: none;">
          <div class="spinner-border text-primary" role="status"></div>
          <span>Cargando modelo...</span>
        </div>
      </div>
    </main>

    <!-- Prediction History -->
    <section class="container mt-5">
      <h2>Historial de Predicciones</h2>
      <ul id="historial" class="list-group">
        <!-- Predicciones aparecerán aquí -->
      </ul>
    </section>

    <!-- Probabilities Section -->
    <section class="container mt-5">
      <h2>Probabilidades de Predicción</h2>
      <table class="table table-bordered text-center">
        <thead>
          <tr>
            <th>Dígito</th>
            <th>Probabilidad (%)</th>
          </tr>
        </thead>
        <tbody id="tabla-probabilidades">
          <!-- Probabilidades aparecerán aquí -->
        </tbody>
      </table>
    </section>

    <!-- Footer -->
    <footer class="text-center">
      <p>Datos utilizados: <a href="http://yann.lecun.com/exdb/mnist/" target="_blank" style="color: #ffc107;">MNIST Dataset</a></p>
      <p>Desarrollado para el curso "Architecting with Google Compute Engine".</p>
      <small>&copy; 2024 Maestría en Estadística Aplicada y Ciencia de Datos</small>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="dibujo.js"></script>

    <script>
      var modelo = null;

      async function cargarModelo() {
        console.log("Cargando modelo...");
        document.getElementById("loading").style.display = "block";
        try {
          modelo = await tf.loadGraphModel('./model.json'); 
          console.log("Modelo cargado correctamente.");
          document.getElementById("predecir").disabled = false;
        } catch (error) {
          console.error("Error al cargar el modelo:", error);
        } finally {
          document.getElementById("loading").style.display = "none";
        }
      }

      function limpiar() {
        var canvas = document.getElementById("bigcanvas");
        var ctx1 = canvas.getContext("2d");
        ctx1.clearRect(0, 0, canvas.width, canvas.height);
      }

      function predecir() {
        // Lógica de predicción...
        console.log("Predicción realizada.");
      }

      cargarModelo();
    </script>
  </body>
</html>
